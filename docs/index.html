<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>R Package For Microglia Morphology Analysis • MicrogliaMorphologyR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="R Package For Microglia Morphology Analysis">
<meta name="description" content="MicrogliaMorphologyR is complimentary to ImageJ macro MicrogliaMorphology. You can use MicrogliaMorphologyR to perform exploratory data analysis and visualization of 27 different morphology features, characterize morphological cluster identities, quantify shifts in morphological populations, generate heatmap and boxplot visualizations of data in flexible ways including at the single-cell level, animal-level, and experimental condition-level, and perform statistical analysis of your data.">
<meta property="og:description" content="MicrogliaMorphologyR is complimentary to ImageJ macro MicrogliaMorphology. You can use MicrogliaMorphologyR to perform exploratory data analysis and visualization of 27 different morphology features, characterize morphological cluster identities, quantify shifts in morphological populations, generate heatmap and boxplot visualizations of data in flexible ways including at the single-cell level, animal-level, and experimental condition-level, and perform statistical analysis of your data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">MicrogliaMorphologyR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="microgliamorphologyr">MicrogliaMorphologyR<a class="anchor" aria-label="anchor" href="#microgliamorphologyr"></a>
</h1></div>
<p><strong>Created</strong>: 26 June, 2023<br><strong>Last updated</strong>: 02 August, 2024</p>
<div class="section level2">
<h2 id="welcome-to-microgliamorphologyr">Welcome to MicrogliaMorphologyR!<a class="anchor" aria-label="anchor" href="#welcome-to-microgliamorphologyr"></a>
</h2>
<p>MicrogliaMorphologyR is an R package for microglia morphology analysis, that is complimentary to ImageJ macro <a href="https://github.com/ciernialab/MicrogliaMorphology" class="external-link">MicrogliaMorphology</a>. Using MicrogliaMorphologyR, you can perform exploratory data analysis and visualization of 27 different morphology features, characterize morphological cluster identities, quantify shifts in morphological populations, generate heatmap and boxplot visualizations of data in flexible ways including at the single-cell level, animal-level, and experimental condition-level, and perform statistical analysis of your data.</p>
<p>You can read more about any of the MicrogliaMorphologyR functions covered in this tutorial by calling to their respective help pages by running ?function_name in the console.</p>
<div class="section level3">
<h3 id="if-you-are-using-this-tool-please-cite-the-following-publications">If you are using this tool, please cite the following publications:<a class="anchor" aria-label="anchor" href="#if-you-are-using-this-tool-please-cite-the-following-publications"></a>
</h3>
<ul><li><a href="https://www.eneuro.org/content/11/7/ENEURO.0014-24.2024" class="external-link">Development of a high-throughput pipeline to characterize microglia morphological states at a single-cell resolution</a></li></ul>
<p>Kim J, Pavlidis P, Ciernia AV. Development of a High-Throughput Pipeline to Characterize Microglia Morphological States at a Single-Cell Resolution. eNeuro. 2024 Jul 30;11(7):ENEURO.0014-24.2024. doi: 10.1523/ENEURO.0014-24.2024. PMID: 39029952; PMCID: PMC11289588.</p>
</div>
<div class="section level3">
<h3 id="microglia-morphology">Microglia morphology<a class="anchor" aria-label="anchor" href="#microglia-morphology"></a>
</h3>
<p>Microglia exhibit a dynamic range of morphologies that are context-specific and often rapidly changing in response to environmental cues. While microglia more realistically exist along a continuous spectrum of morphology, we can categorize them by their most commonly observed forms to study microglia morphology. Here, we highlight the four most commonly studied morphological classes, but others have also been characterized including hyper-ramified, dystrophic, satellite, etc. MicrogliaMorphologyR can also be used to characterize additional morphologies beyond these four. <img src="./README_files/images/GithubIntro_MicrogliaMorphologies.png"></p>
<ul>
<li>
<strong>Ameboid</strong> = round, few processes</li>
<li>
<strong>Hypertrophic</strong> = thicker, shorter processes with larger soma</li>
<li>
<strong>Rod-like</strong> = elongated soma with bipolar processes</li>
<li>
<strong>Ramified</strong> = smaller soma with long, highly branched processes</li>
</ul>
<p>Here are some recent and relevant reviews that you can read to gain more background on microglia morphology and this project:</p>
<ul>
<li><a href="https://www.frontiersin.org/articles/10.3389/fninf.2023.1211188/full" class="external-link">Microglial morphometric analysis: so many options, so little consistency (Reddaway et al., 2023)</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9999291/" class="external-link">Microglia states and nomenclature: A field at its crossroads (Paolicelli et al., 2022)</a></li>
<li><a href="https://link.springer.com/protocol/10.1007/978-1-4939-9658-2_2" class="external-link">Morphology of Microglia Across Contexts of Health and Disease (Savage et al., 2019)</a></li>
</ul>
</div>
</div>
</div>
<div class="section level1">
<h1 id="instructions-on-how-to-use-microgliamorphologyr">Instructions on how to use MicrogliaMorphologyR<a class="anchor" aria-label="anchor" href="#instructions-on-how-to-use-microgliamorphologyr"></a>
</h1>
<div class="section level3">
<h3 id="install-load-packages-and-set-seed-for-reproducibility-of-results-shown">Install, load packages, and set seed for reproducibility of results shown<a class="anchor" aria-label="anchor" href="#install-load-packages-and-set-seed-for-reproducibility-of-results-shown"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'ciernialab/MicrogliaMorphologyR'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ciernialab.github.io/MicrogliaMorphologyR/">MicrogliaMorphologyR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra" class="external-link">factoextra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ppclust</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We will start by loading in your MicrogliaMorphology output (FracLac and SkeletonAnalysis files) and formatting the data using the <code>metadata_columns</code> function so that you have a final dataframe which contains your cell-level data, with every row as a single cell and every column as either a metadata descriptor or morphology measure. The <code>metadata_columns</code> function relies on each piece of metadata to be separated by a common deliminator such as “_” or “-” in the “Name” column. You can read more about the function by calling to its help page using ?metadata_columns</p>
</div>
<div class="section level3">
<h3 id="load-in-your-fraclac-and-skeleton-data-tidy-and-merge-into-final-data-frame">Load in your fraclac and skeleton data, tidy, and merge into final data frame<a class="anchor" aria-label="anchor" href="#load-in-your-fraclac-and-skeleton-data-tidy-and-merge-into-final-data-frame"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fraclac.dir</span> <span class="op">&lt;-</span> <span class="st">"insert path to fraclac directory"</span></span>
<span><span class="va">skeleton.dir</span> <span class="op">&lt;-</span> <span class="st">"insert path to skeleton analysis directory"</span></span>
<span></span>
<span><span class="co"># these steps may be very time-intensive, depending on how many cells you are analyzing (i.e., on the order of 1000s of cells). </span></span>
<span><span class="va">fraclac</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fraclac_tidying.html">fraclac_tidying</a></span><span class="op">(</span><span class="va">fraclac.dir</span><span class="op">)</span> </span>
<span><span class="va">skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/skeleton_tidying.html">skeleton_tidying</a></span><span class="op">(</span><span class="va">skeleton.dir</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/merge_data.html">merge_data</a></span><span class="op">(</span><span class="va">fraclac</span>, <span class="va">skeleton</span><span class="op">)</span></span>
<span><span class="va">finaldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/metadata_columns.html">metadata_columns</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Antibody"</span>,<span class="st">"Paper"</span>,<span class="st">"Cohort"</span>,<span class="st">"MouseID"</span>,<span class="st">"Sex"</span>,<span class="st">"Treatment"</span>,<span class="st">"BrainRegion"</span>,<span class="st">"Subregion"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span></code></pre></div>
<p>For demonstration purposes, we will use one of the datasets that comes packaged with MicrogliaMorphologyR. ‘data_2xLPS_mouse’ contains morphology data collected from female and male 8 week-old Cx3cr1-eGFP mice, which were given 2 i.p. injections of either PBS vehicle solution or 0.5mg/kg lipopolysaccharides (LPS), spaced 24 hours apart. In this genetic mouse line, Cx3cr1-expressing cells including microglia have an endogenous reporter which makes them green when immunofluorescently imaged. Brains were collected 3 hours after the final injections, and brain sections were immunofluorescently stained and imaged for 2 additional, commonly used microglia markers: P2ry12, and Iba1.</p>
</div>
<div class="section level3">
<h3 id="load-in-example-dataset">Load in example dataset<a class="anchor" aria-label="anchor" href="#load-in-example-dataset"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_2xLPS</span> <span class="op">&lt;-</span> <span class="fu">MicrogliaMorphologyR</span><span class="fu">::</span><span class="va"><a href="reference/data_2xLPS_mouse.html">data_2xLPS_mouse</a></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-heatmap-of-correlations-across-features">Generate heatmap of correlations across features<a class="anchor" aria-label="anchor" href="#generate-heatmap-of-correlations-across-features"></a>
</h3>
<p>We start by exploring the morphology features measured by MicrogliaMorphology and how they relate to each other by generating a heatmap of spearman’s correlations across the 27 different morphology features. As expected, the features which describe similar aspects of morphology are more highly correlated to each other than to other features which do not. For example, the numbers of end point voxels, junction voxels, triple points, branches, and junctions all explain cell branching complexity and are highly correlated to each other.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/featurecorrelations.html">featurecorrelations</a></span><span class="op">(</span><span class="va">data_2xLPS</span>,</span>
<span>                    featurestart<span class="op">=</span><span class="fl">9</span>, featureend<span class="op">=</span><span class="fl">35</span>,</span>
<span>                    rthresh<span class="op">=</span><span class="fl">0.8</span>, pthresh<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Correlations across features"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-6-1.png"><!-- --></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to get the underlying stats depicted in the heatmap above</span></span>
<span><span class="va">correlationstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/featurecorrelations_stats.html">featurecorrelations_stats</a></span><span class="op">(</span><span class="va">data_2xLPS</span>,</span>
<span>                                             featurestart<span class="op">=</span><span class="fl">9</span>, featureend<span class="op">=</span><span class="fl">35</span>,</span>
<span>                                             rthresh<span class="op">=</span><span class="fl">0.8</span>, pthresh<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">correlationstats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">##       measure_a             measure_b correlation pvalues Significant</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 # of branches         # of branches   1.0000000      NA        &lt;NA&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 # of branches # of end point voxels   0.9425514       0 significant</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 # of branches  # of junction voxels   0.9757485       0 significant</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 # of branches        # of junctions   0.9970174       0 significant</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 # of branches # of quadruple points   0.5349538       0          ns</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 # of branches      # of slab voxels   0.9464104       0 significant</span></span></code></pre></div>
<p>MicrogliaMorphologyR comes with a number of functions which allow you to explore which features have extreme outliers and how normalizing in various ways changes your feature distributions. This allows you to explore and transform your data in a dataset-appropriate manner for downstream analyses. In later steps, we will be running Principal Components Analysis (PCA) on our transformed data. PCA is a statistical technique which identifies the most significant variables and relationships in your data, and can be used as a pre-processing step to reduce noise and remove irrelevant features to improve the efficiency and accuracy of downstream analysis. PCA assumes that the variables in your dataset follow a normal distribution, and violations of normality can affect the accuracy of PCA results. Thus, it is important to transform your data so that the distributions of the values for each individual morphology measure approximate normality as much as possible.</p>
<p>The morphology features measured using MicrogliaMorphology are often suitable for PCA after log transformation. Because many of the measures contain zero values (e.g., numbers of junctions, numbers of branches, etc.), we need to add a constant to our data prior to log transforming.</p>
</div>
<div class="section level3">
<h3 id="exploratory-data-visualization-and-data-transformation-for-downstream-analyses">Exploratory data visualization and data transformation for downstream analyses<a class="anchor" aria-label="anchor" href="#exploratory-data-visualization-and-data-transformation-for-downstream-analyses"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gather your numerical morphology data into one column ('measure') which contains the feature name, and another column ('value') which contains measured values</span></span>
<span><span class="va">data_2xLPS_gathered</span> <span class="op">&lt;-</span> <span class="va">data_2xLPS</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">value</span>, <span class="fl">9</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_2xLPS</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check for outliers</span></span>
<span><span class="fu"><a href="reference/outliers_boxplots.html">outliers_boxplots</a></span><span class="op">(</span><span class="va">data_2xLPS_gathered</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-1.png"><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/outliers_distributions.html">outliers_distributions</a></span><span class="op">(</span><span class="va">data_2xLPS_gathered</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-2.png"><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># checking different normalization features</span></span>
<span><span class="fu"><a href="reference/normalize_logplots.html">normalize_logplots</a></span><span class="op">(</span><span class="va">data_2xLPS_gathered</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-3.png"><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/normalize_minmax.html">normalize_minmax</a></span><span class="op">(</span><span class="va">data_2xLPS_gathered</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-4.png"><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/normalize_scaled.html">normalize_scaled</a></span><span class="op">(</span><span class="va">data_2xLPS_gathered</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-5.png"><!-- --></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># transform your data in appropriate manner for downstream analyses</span></span>
<span><span class="co"># we will use the logtransformed data as our PCA input</span></span>
<span><span class="va">data_2xLPS_logtransformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/transform_log.html">transform_log</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, <span class="fl">1</span>, start<span class="op">=</span><span class="fl">9</span>, end<span class="op">=</span><span class="fl">35</span><span class="op">)</span> </span>
<span><span class="va">data_2xLPS_minmaxtransformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/transform_minmax.html">transform_minmax</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, start<span class="op">=</span><span class="fl">9</span>, end<span class="op">=</span><span class="fl">35</span><span class="op">)</span></span>
<span><span class="va">data_2xLPS_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/transform_scale.html">transform_scale</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, start<span class="op">=</span><span class="fl">9</span>, end<span class="op">=</span><span class="fl">35</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get sample size of data based on factors of interest</span></span>
<span><span class="fu"><a href="reference/samplesize.html">samplesize</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, <span class="va">MouseID</span>, <span class="va">Antibody</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 18 × 3</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   MouseID [6]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    MouseID Antibody   num</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 1       Cx3cr1    1703</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 1       Iba1      1737</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 1       P2ry12    2105</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 2       Cx3cr1    2496</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 2       Iba1      2927</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 2       P2ry12    4341</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 3       Cx3cr1    1145</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 3       Iba1      1310</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 3       P2ry12    1978</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 4       Cx3cr1    1775</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 4       Iba1      2044</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 4       P2ry12    2372</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 5       Cx3cr1    2053</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 5       Iba1      2302</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 5       P2ry12    3513</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 6       Cx3cr1    2771</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 6       Iba1      3095</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 6       P2ry12    3665</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/samplesize.html">samplesize</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, <span class="va">Sex</span>, <span class="va">Treatment</span>, <span class="va">Antibody</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 × 4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Sex, Treatment [4]</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Sex   Treatment Antibody   num</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 F     2xLPS     Cx3cr1    3478</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 F     2xLPS     Iba1      3781</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 F     2xLPS     P2ry12    4477</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 F     PBS       Cx3cr1    3641</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 F     PBS       Iba1      4237</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 F     PBS       P2ry12    6319</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 M     2xLPS     Cx3cr1    2771</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 M     2xLPS     Iba1      3095</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 M     2xLPS     P2ry12    3665</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 M     PBS       Cx3cr1    2053</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 M     PBS       Iba1      2302</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 M     PBS       P2ry12    3513</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="obtain-density-measures-for-each-image-using-areascsv-file-output-from-microgliamorphology">Obtain density measures for each image (using Areas.csv file output from MicrogliaMorphology)<a class="anchor" aria-label="anchor" href="#obtain-density-measures-for-each-image-using-areascsv-file-output-from-microgliamorphology"></a>
</h3>
<p>Note: The areas obtained in this file are dataset-specific and will be in the units of your original input images</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list out all variables of interest present in the original image names to obtain numbers of microglia per image</span></span>
<span><span class="va">microglianumbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/samplesize.html">samplesize</a></span><span class="op">(</span><span class="va">data_2xLPS</span>, <span class="va">Antibody</span>, <span class="va">MouseID</span>, <span class="va">Sex</span>, <span class="va">Treatment</span>, <span class="va">BrainRegion</span>, <span class="va">Subregion</span><span class="op">)</span> </span>
<span><span class="va">microglianumbers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">3</span>, width<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 148 × 7</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Antibody, MouseID, Sex, Treatment, BrainRegion [51]</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   Antibody MouseID Sex   Treatment BrainRegion Subregion   num</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Cx3cr1   1       F     2xLPS     FC          ACC          93</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Cx3cr1   1       F     2xLPS     FC          IL          161</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Cx3cr1   1       F     2xLPS     FC          PL          112</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 145 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add Name column back in -- make sure that the resulting strings in the Name column match the names of your original input .tiff files that you used for MicrogliaMorphology !!</span></span>
<span><span class="va">microglianumbers</span> <span class="op">&lt;-</span> <span class="va">microglianumbers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">unite</span><span class="op">(</span><span class="st">"Name"</span>, <span class="va">Antibody</span><span class="op">:</span><span class="va">Subregion</span>, sep<span class="op">=</span><span class="st">"_"</span>, remove<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="va">microglianumbers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">3</span>, width<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 148 × 8</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Antibody, MouseID, Sex, Treatment, BrainRegion [51]</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   Name                    Antibody MouseID Sex   Treatment BrainRegion Subregion</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;    </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Cx3cr1_1_F_2xLPS_FC_ACC Cx3cr1   1       F     2xLPS     FC          ACC      </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Cx3cr1_1_F_2xLPS_FC_IL  Cx3cr1   1       F     2xLPS     FC          IL       </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Cx3cr1_1_F_2xLPS_FC_PL  Cx3cr1   1       F     2xLPS     FC          PL       </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     num</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;int&gt;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    93</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2   161</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3   112</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 145 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># path to Areas.csv file</span></span>
<span><span class="va">AreasPath</span> <span class="op">&lt;-</span> <span class="st">"./README_files/files/Areas.csv"</span> </span>
<span></span>
<span><span class="co"># use celldensity function to calculate density at image-level: values are under the "Density" column</span></span>
<span><span class="va">Density</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/celldensity.html">celldensity</a></span><span class="op">(</span><span class="va">AreasPath</span>, <span class="va">microglianumbers</span><span class="op">)</span></span>
<span><span class="va">Density</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">5</span>, width<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 148 × 10</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Antibody, MouseID, Sex, Treatment, BrainRegion [51]</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   Name                    Antibody MouseID Sex   Treatment BrainRegion Subregion</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;    </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Cx3cr1_1_F_2xLPS_FC_ACC Cx3cr1   1       F     2xLPS     FC          ACC      </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Cx3cr1_1_F_2xLPS_FC_IL  Cx3cr1   1       F     2xLPS     FC          IL       </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Cx3cr1_1_F_2xLPS_FC_PL  Cx3cr1   1       F     2xLPS     FC          PL       </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Cx3cr1_1_F_2xLPS_HC_CA1 Cx3cr1   1       F     2xLPS     HC          CA1      </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Cx3cr1_1_F_2xLPS_HC_CA2 Cx3cr1   1       F     2xLPS     HC          CA2      </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="do">##     num     Area  Density</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    93  333722. 0.000279</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2   161  589983. 0.000273</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3   112  423038. 0.000265</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 4   263 1018060. 0.000258</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 5    43  172581. 0.000249</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 143 more rows</span></span></code></pre></div>
<div class="section level5">
<h5 id="if-you-want-to-group-on-another-variable-and-then-recalculate-calculate-density">if you want to group on another variable, and then recalculate calculate density<a class="anchor" aria-label="anchor" href="#if-you-want-to-group-on-another-variable-and-then-recalculate-calculate-density"></a>
</h5>
<p>e.g., calculating density at the brain region-level rather than the subregion level (which are what the image rois capture in our example dataset)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Density</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Antibody</span>, <span class="va">MouseID</span>, <span class="va">Sex</span>, <span class="va">Treatment</span>, <span class="va">BrainRegion</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>num<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>, Area<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># calculate new cell numbers and new areas at the brain region level</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Density<span class="op">=</span><span class="va">num</span><span class="op">/</span><span class="va">Area</span><span class="op">)</span> <span class="co"># calculate new density at the brain region level</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by 'Antibody', 'MouseID', 'Sex', 'Treatment'.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## You can override using the `.groups` argument.</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 51 × 8</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Antibody, MouseID, Sex, Treatment [18]</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    Antibody MouseID Sex   Treatment BrainRegion   num     Area  Density</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Cx3cr1   1       F     2xLPS     FC            366 1346743. 0.000272</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Cx3cr1   1       F     2xLPS     HC            723 2705033. 0.000267</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Cx3cr1   1       F     2xLPS     STR           614 2229707. 0.000275</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Cx3cr1   2       F     PBS       FC            523 1758434. 0.000297</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Cx3cr1   2       F     PBS       HC            667 2448885. 0.000272</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Cx3cr1   2       F     PBS       STR          1306 4608609. 0.000283</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Cx3cr1   3       F     PBS       FC            412 1496417. 0.000275</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Cx3cr1   3       F     PBS       STR           733 2624917. 0.000279</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Cx3cr1   4       F     2xLPS     FC            375 1762321. 0.000213</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Cx3cr1   4       F     2xLPS     HC            503 2154789. 0.000233</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 41 more rows</span></span></code></pre></div>
<p>Now, since we have gotten a better feel for our data and how to transform it, we can proceed with PCA for dimensionality reduction and downstream clustering. We can see here that the first 3 PCs describe around ~85% of our data. We can also explore how each PC correlates to the 27 different morphology features to get a better understanding of how each PC describes the variability present in the data. This is useful to inform which to include for downstream clustering steps.</p>
</div>
</div>
<div class="section level2">
<h2 id="dimensionality-reduction-using-pca">Dimensionality reduction using PCA<a class="anchor" aria-label="anchor" href="#dimensionality-reduction-using-pca"></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pcadata_elbow.html">pcadata_elbow</a></span><span class="op">(</span><span class="va">data_2xLPS_logtransformed</span>, featurestart<span class="op">=</span><span class="fl">9</span>, featureend<span class="op">=</span><span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-1.png"><!-- --></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pcadata.html">pcadata</a></span><span class="op">(</span><span class="va">data_2xLPS_logtransformed</span>, featurestart<span class="op">=</span><span class="fl">9</span>, featureend<span class="op">=</span><span class="fl">35</span>,</span>
<span>                    pc.start<span class="op">=</span><span class="fl">1</span>, pc.end<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pca_data</span>,<span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           PC1       PC2        PC3        PC4         PC5         PC6</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -3.40837468 0.6764322  2.4544974 -0.7011076  0.51923399  0.09841964</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -3.97236479 0.6876435 -0.1588262 -1.7816133 -0.29998161 -0.39435933</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -0.05205818 0.4984643  1.1106371 -1.7095791  0.05149981 -0.88502415</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="do">##          PC7        PC8        PC9       PC10 Antibody MouseID Sex Treatment</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -0.1887577 -0.2217257 -1.4166585  0.7370713   Cx3cr1       1   F     2xLPS</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -0.4914042 -0.5946128  0.1761947 -0.2787745   Cx3cr1       1   F     2xLPS</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -0.1504321 -0.1952254 -0.6739042  0.3673300   Cx3cr1       1   F     2xLPS</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   BrainRegion Subregion          ID</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          FC       ACC 00002-01053</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          FC       ACC 00009-01153</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          FC       ACC 00015-01224</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          UniqueID Foreground pixels</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00002-01053          7.838343</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00009-01153          7.837554</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00015-01224          8.516593</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   Density of foreground pixels in hull area</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                 0.4722511</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                 0.5270926</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                 0.5027128</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   Span ratio of hull (major/minor axis) Maximum span across hull     Area</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                             0.8187220                 4.516565 8.343078</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                             0.9121221                 4.512384 8.202756</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                             0.8887962                 4.867296 8.942330</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="do">##   Perimeter Circularity Width of bounding rectangle</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  5.579191   0.5642337                    4.406719</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  5.458799   0.6092219                    4.219508</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  5.863106   0.5771189                    4.682131</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="do">##   Height of bounding rectangle Maximum radius from hull's center of mass</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                     4.488636                                  3.945005</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                     4.532599                                  3.927930</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                     4.779123                                  4.213828</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   Max/min radii from hull's center of mass</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                 1.017764</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                 1.085460</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                 1.044754</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   Relative variation (CV) in radii from hull's center of mass Mean radius</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                                   0.1031882    3.833051</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                                   0.1719345    3.666266</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                                   0.1264564    4.100085</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="do">##   Diameter of bounding circle Maximum radius from circle's center of mass</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                    4.600622                                    3.917470</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                    4.512384                                    3.830149</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                    4.884708                                    4.199093</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="do">##   Max/min radii from circle's center of mass</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                  0.9896899</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                  0.9603076</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                  0.9981288</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="do">##   Relative variation (CV) in radii from circle's center of mass</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                                     0.1008403</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                                     0.1573456</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                                     0.1276013</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="do">##   Mean radius from circle's center of mass # of branches # of junctions</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                 3.828354      2.564949       1.945910</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                 3.649437      2.708050       1.945910</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                 4.100996      3.135494       2.484907</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="do">##   # of end point voxels # of junction voxels # of slab voxels</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="do">## 1              1.945910             2.564949         5.484797</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="do">## 2              2.302585             2.708050         5.342334</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="do">## 3              2.397895             3.135494         5.846439</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="do">##   Average branch length # of triple points # of quadruple points</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="do">## 1              2.275111           1.945910             0.0000000</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="do">## 2              2.044073           1.791759             0.6931472</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="do">## 3              2.100836           2.397895             0.6931472</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="do">##   Maximum branch length</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="do">## 1              3.409033</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="do">## 2              2.778384</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a><span class="do">## 3              3.102836</span></span></code></pre></div>
<div class="section level3">
<h3 id="generate-heatmap-of-correlations-between-pcs-and-features">Generate heatmap of correlations between PCs and features<a class="anchor" aria-label="anchor" href="#generate-heatmap-of-correlations-between-pcs-and-features"></a>
</h3>
<p>Using the <code>pcfeaturecorrelations</code> function, we can investigate the relationships of our 27 individual morphology measures to the principle components to examine how each PC is differentially correlated to and described by different sets of morphology features. For example, we can see that PC1 is highly positively correlated to features describing branching complexity and territory span, meaning that individual cells with greater branching complexity or area have higher PC1 scores in our dataset. Similarly, the variability in our dataset represented in PC2 is described by cell shape: 1) <em>circularity</em> (circularity, max/min radii from center, span ratio of hull) and 2) <em>branching homogeneity</em> (relative variation (CV) from center of mass), and PC3 is described by branch length-related measures. Generally, you will see the same types of features describing the first four PCs after dimensionality reduction, although the directionality of the correlations could be inversed, which is normal as long as the sets of features that are highly correlated (e.g., circularity and branching homogeneity for PC2) are still maintained.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pcfeaturecorrelations.html">pcfeaturecorrelations</a></span><span class="op">(</span><span class="va">pca_data</span>, pc.start<span class="op">=</span><span class="fl">1</span>, pc.end<span class="op">=</span><span class="fl">3</span>, </span>
<span>                      feature.start<span class="op">=</span><span class="fl">19</span>, feature.end<span class="op">=</span><span class="fl">45</span>, </span>
<span>                      rthresh<span class="op">=</span><span class="fl">0.75</span>, pthresh<span class="op">=</span><span class="fl">0.05</span>, </span>
<span>                      title<span class="op">=</span><span class="st">"Correlation between PCs and features"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to get the underlying stats depicted in the heatmap above</span></span>
<span><span class="va">correlationstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pcfeaturecorrelations_stats.html">pcfeaturecorrelations_stats</a></span><span class="op">(</span><span class="va">pca_data</span>, pc.start<span class="op">=</span><span class="fl">1</span>, pc.end<span class="op">=</span><span class="fl">3</span>,</span>
<span>                                                feature.start<span class="op">=</span><span class="fl">19</span>, feature.end<span class="op">=</span><span class="fl">45</span>,</span>
<span>                                                rthresh<span class="op">=</span><span class="fl">0.75</span>, pthresh<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">correlationstats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">##               measure_a measure_b correlation pvalues Significant</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1         # of branches       PC1   0.9202371       0 significant</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2         # of branches       PC2   0.1922737       0          ns</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3         # of branches       PC3  -0.2115683       0          ns</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 # of end point voxels       PC1   0.9063301       0 significant</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 # of end point voxels       PC2   0.1644570       0          ns</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 # of end point voxels       PC3  -0.1465995       0          ns</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visually-explore-different-sources-of-variability-in-dataset">Visually explore different sources of variability in dataset<a class="anchor" aria-label="anchor" href="#visually-explore-different-sources-of-variability-in-dataset"></a>
</h3>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gather your data by experimental variables (e.g., Treatment, Sex, MouseID, etc.)</span></span>
<span><span class="va">gathered_expvariables</span> <span class="op">&lt;-</span> <span class="va">pca_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="reference/plots_expvariable.html">plots_expvariable</a></span><span class="op">(</span><span class="va">gathered_expvariables</span>, <span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-12-1.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="k-means-clustering-on-pcs">K-means clustering on PCs<a class="anchor" aria-label="anchor" href="#k-means-clustering-on-pcs"></a>
</h2>
<p>After performing dimensionality reduction, we can use our PCs as input for downstream clustering methods. In this tutorial, we cluster our cells into morphological classes using k-means clustering, which partitions data points within a given dataset into defined numbers of clusters based on their proximity to the nearest cluster’s centroid. We provide an example at the end of the Github to depict a use case for fuzzy k-means clustering, a soft clustering approach and another option which allows for extended analyses such as characterization of the ‘most’ ameboid, hypertrophic, rod-like, or ramified cells or characterization of cells with more ambiguous identities that lie between these morphological states - see <a href="https://github.com/ciernialab/MicrogliaMorphologyR#fuzzy-k-means-clustering" class="external-link">‘Fuzzy K-means clustering’ section</a> at the end of Github for more details about the method. Because our toolset is highly flexible, it can also be integrated with other clustering approaches such as hierarchical clustering or gaussian mixture models.</p>
<p>When running kmeans clustering, from the number of clusters (K) that you specify to create, the algorithm will randomly select K initial cluster centers. Each other data point’s euclidean distance will be calculated from these initial centers so that they are assigned as belonging to the cluster that they are closest to. The centroids for each of the clusters will be updated by calculating the new means of all the points assigned to each cluster. The process of randomly setting initial centers, assigning data points to the clusters, and updating the cluster centroids is iterated until the maximum number of iterations is reached.</p>
<p>Thus, 2 main dataset-specific parameters that you should specify and troubleshoot for your dataset are:</p>
<ul>
<li>
<strong>iter.max</strong>, the maximum number of iterations allowed, and the number of times kmeans algorithm is run before results are returned. An iter.max between 10-20 is recommended</li>
<li>
<strong>nstart</strong>, how many random sets should be chosen. An nstart of atleast 25 initial configurations is recommended.</li>
</ul>
<p>You can read more about kmeans clustering and optimizing these parameters at the following links:</p>
<ul>
<li><a href="https://uc-r.github.io/kmeans_clustering" class="external-link">K-means Cluster Analysis</a></li>
<li><a href="https://andrea-grianti.medium.com/kmeans-parameters-in-rstudio-explained-c493ec5a05df" class="external-link">K Means parameters and results (in R Studio) explained</a></li>
</ul>
<div class="section level3">
<h3 id="prepare-data-for-clustering">Prepare data for clustering<a class="anchor" aria-label="anchor" href="#prepare-data-for-clustering"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## for k-means clustering: scale PCs 1-3, which together describe ~85% of variability</span></span>
<span><span class="va">pca_data_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/transform_scale.html">transform_scale</a></span><span class="op">(</span><span class="va">pca_data</span>, start<span class="op">=</span><span class="fl">1</span>, end<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="co"># scale pca data as input for k-means clustering</span></span>
<span><span class="va">kmeans_input</span> <span class="op">&lt;-</span> <span class="va">pca_data_scale</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cluster-optimization-prior-to-running-fuzzy-k-means">Cluster optimization prior to running fuzzy k-means<a class="anchor" aria-label="anchor" href="#cluster-optimization-prior-to-running-fuzzy-k-means"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check for optimal number of clusters using wss and silhouette methods</span></span>
<span><span class="va">sampling</span> <span class="op">&lt;-</span> <span class="va">kmeans_input</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">kmeans_input</span><span class="op">)</span>, <span class="fl">5000</span><span class="op">)</span>,<span class="op">]</span> <span class="co">#sample 5000 random rows for cluster optimization</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html" class="external-link">fviz_nbclust</a></span><span class="op">(</span><span class="va">sampling</span>, <span class="va">kmeans</span>, method <span class="op">=</span> <span class="st">'wss'</span>, nstart<span class="op">=</span><span class="fl">25</span>, iter.max<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co"># 4 clusters</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-14-1.png"><!-- --></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html" class="external-link">fviz_nbclust</a></span><span class="op">(</span><span class="va">sampling</span>, <span class="va">kmeans</span>, method <span class="op">=</span> <span class="st">'silhouette'</span>, nstart<span class="op">=</span><span class="fl">25</span>, iter.max<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co"># 4 clusters</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-14-2.png"><!-- --></p>
<p>From using the wss and silhouette methods to check the optimal numbers of clusters for our dataset, it appears that our data would be optimally clustered using k=4. There are many more <a href="http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/" class="external-link">cluster optimization methods</a> that you can try out to explore your data.</p>
<p>Next, we proceed with the actual clustering. You can cluster using fuzzy k-means or regular k-means at this step. After clustering, we will use some built-in functions within MicrogliaMorphologyR to assess how a parameter of k=4 influences how the clusters are defined by morphology features (and if they make sense according to what we know about microglia morphology). As this step may require some troubleshooting and updating of clustering parameters, you may need to run your k-means function multiple times. If you are planning to use fuzzy k-means, keep in mind that the <strong>soft clustering approach is more time-intensive and computationally expensive</strong> as it also calculates membership scores to each cluster for every single cell. It might help to use regular k-means as a first pass, verify that your clusters make sense using the functions that follow, and run your fuzzy k-means function using the final parameters that you determine to generate your final dataset for downstream analysis.</p>
<p>For the analysis proceeding, we are working with the regular k-means clustering output. We provide an example of a use case for fuzzy k-means clustering and further description of this approach at the <a href="https://github.com/ciernialab/MicrogliaMorphologyR#fuzzy-k-means-clustering" class="external-link">end of the Github</a> if you are interested.</p>
</div>
<div class="section level3">
<h3 id="fuzzy-k-means-soft-clustering">Fuzzy k-means (soft clustering)<a class="anchor" aria-label="anchor" href="#fuzzy-k-means-soft-clustering"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cluster and combine with original data</span></span>
<span><span class="va">data_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ppclust/man/fcm.html" class="external-link">fcm</a></span><span class="op">(</span><span class="va">kmeans_input</span>, centers<span class="op">=</span><span class="fl">4</span>, nstart<span class="op">=</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">pca_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pca_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">data_kmeans</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regular-k-means-hard-clustering">Regular k-means (hard clustering)<a class="anchor" aria-label="anchor" href="#regular-k-means-hard-clustering"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cluster and combine with original data</span></span>
<span><span class="va">data_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">kmeans_input</span>, centers<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here, we are creating a new data frame that contains the first 2 PCs and original dataset, then renaming the data_kmeans$cluster column to simply say "Cluster". You can bind together as many of the PCs as you want. Binding the original, untransformed data is useful if you want to plot the raw values of any individual morphology measures downstream. </span></span>
<span><span class="va">pca_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pca_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">data_2xLPS</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data_kmeans</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>Cluster<span class="op">=</span><span class="va">`data_kmeans$cluster`</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pca_kmeans</span>,<span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           PC1       PC2 Antibody MouseID Sex Treatment BrainRegion Subregion</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -3.40837468 0.6764322   Cx3cr1       1   F     2xLPS          FC       ACC</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -3.97236479 0.6876435   Cx3cr1       1   F     2xLPS          FC       ACC</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -0.05205818 0.4984643   Cx3cr1       1   F     2xLPS          FC       ACC</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="do">##            ID                                        UniqueID Foreground pixels</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 00002-01053 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00002-01053              2535</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 00009-01153 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00009-01153              2533</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 00015-01224 Cx3cr1_Paper1_2Hit_1_F_2xLPS_FC_ACC_00015-01224              4996</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   Density of foreground pixels in hull area</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                    0.6036</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                    0.6940</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                    0.6532</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   Span ratio of hull (major/minor axis) Maximum span across hull Area Perimeter</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                1.2676                  90.5207 4200  263.8573</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                1.4896                  90.1388 3650  233.8153</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                1.4322                 128.9690 7648  350.8153</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   Circularity Width of bounding rectangle Height of bounding rectangle</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      0.7581                          81                           88</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      0.8390                          67                           92</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      0.7809                         107                          118</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   Maximum radius from hull's center of mass</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                   50.6766</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                   49.8017</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                   66.6149</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="do">##   Max/min radii from hull's center of mass</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                   1.7670</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                   1.9608</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                   1.8427</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="do">##   Relative variation (CV) in radii from hull's center of mass Mean radius</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                                      0.1087     45.2033</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                                      0.1876     38.1056</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                                      0.1348     59.3454</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   Diameter of bounding circle Maximum radius from circle's center of mass</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                     98.5462                                     49.2731</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                     90.1388                                     45.0694</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                    131.2519                                     65.6259</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   Max/min radii from circle's center of mass</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                     1.6904</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                     1.6125</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                     1.7132</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="do">##   Relative variation (CV) in radii from circle's center of mass</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                                        0.1061</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                                        0.1704</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                                        0.1361</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="do">##   Mean radius from circle's center of mass # of branches # of junctions</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                                  44.9868            12              6</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                                  37.4530            14              6</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                                  59.4004            22             11</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="do">##   # of end point voxels # of junction voxels # of slab voxels</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                     6                   12              240</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                     9                   14              208</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                    10                   22              345</span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="do">##   Average branch length # of triple points # of quadruple points</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                 8.729                  6                     0</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                 6.722                  5                     1</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                 7.173                 10                     1</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="do">##   Maximum branch length Cluster</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                29.236       4</span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                15.093       2</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                21.261       3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-k-means-clusters-in-pc-space">Plot k-means clusters in PC space<a class="anchor" aria-label="anchor" href="#plot-k-means-clusters-in-pc-space"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clusterplots.html">clusterplots</a></span><span class="op">(</span><span class="va">pca_kmeans</span>, <span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span></span>
<span><span class="va">plot</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-17-1.png"><!-- --></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># customizeable example: add color scheme of choice </span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-17-2.png"><!-- --></p>
</div>
<div class="section level3">
<h3 id="cluster-specific-measures-on-average-for-each-morphology-feature-relative-to-other-clusters">Cluster-specific measures on average for each morphology feature, relative to other clusters<a class="anchor" aria-label="anchor" href="#cluster-specific-measures-on-average-for-each-morphology-feature-relative-to-other-clusters"></a>
</h3>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/clusterfeatures.html">clusterfeatures</a></span><span class="op">(</span><span class="va">pca_kmeans</span>, featurestart<span class="op">=</span><span class="fl">11</span>, featureend<span class="op">=</span><span class="fl">37</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-18-1.png"><!-- --></p>
<p>After comparing the individual features across clusters, we can characterize the clusters as follows:</p>
<ul>
<li>Cluster 1 = rod-like (greatest oblongness, lowest circularity)</li>
<li>Cluster 2 = ameboid (lowest territory span, high circularity, smallest branch lengths)</li>
<li>Cluster 3 = ramified (largest territory span and branching complexity)</li>
<li>Cluster 4 = hypertrophic (average territory span, high branch thickness as explained by pixel density in hull)</li>
</ul>
</div>
<div class="section level3">
<h3 id="colorbycluster">ColorByCluster<a class="anchor" aria-label="anchor" href="#colorbycluster"></a>
</h3>
<p>Using the cluster classes assigned from our analyses using MicrogliaMorphologyR, we can color each cell in the original image by cluster using the MicrogliaMorphology ImageJ macro. In the following example, we are isolating out the Cluster assignments for each microglia in the Cx3cr1-stained ACC subregion image for Mouse 1. You can do this for all of the images you are interested in applying ColorByCluster to. This offers an additional method by which to visually assess and verify your suspected cluster identities before deeming them ramifed, hyper-ramified, rod-like, ameboid, or any other morphological form for downstream analysis and interpretation.</p>
<p>Make sure to filter for <em>only</em> the cells belonging to the image you want to run ColorByCluster on.</p>
<div class="section level4">
<h4 id="formatting-data-for-colorbycluster-input-color-coding-in-imagej">Formatting data for ColorByCluster input (Color coding in ImageJ)<a class="anchor" aria-label="anchor" href="#formatting-data-for-colorbycluster-input-color-coding-in-imagej"></a>
</h4>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># isolate out all the cells for your specific image of interest</span></span>
<span><span class="va">colorbycluster</span> <span class="op">&lt;-</span> <span class="va">pca_kmeans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Cx3cr1"</span>,<span class="va">MouseID</span><span class="op">==</span><span class="st">"1"</span>, <span class="va">BrainRegion</span><span class="op">==</span><span class="st">"FC"</span>, <span class="va">Subregion</span><span class="op">==</span><span class="st">"ACC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">colorbycluster</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">##   Cluster          ID</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       4 00002-01053</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       2 00009-01153</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       3 00015-01224</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       4 00016-01229</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       4 00039-01394</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       4 00044-01397</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-csv-file-to-feed-into-colorbycluster-function-in-microgliamorphology-imagej-macro">Save .csv file to feed into ColorByCluster function in MicrogliaMorphology ImageJ macro<a class="anchor" aria-label="anchor" href="#save-csv-file-to-feed-into-colorbycluster-function-in-microgliamorphology-imagej-macro"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">colorbycluster</span>, <span class="st">"filepath/Cxc3cr_Mouse1_FC_ACC_data.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cluster-characterization">Cluster characterization<a class="anchor" aria-label="anchor" href="#cluster-characterization"></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate cluster percentages across variables of interest</span></span>
<span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clusterpercentage.html">clusterpercentage</a></span><span class="op">(</span><span class="va">pca_kmeans</span>, <span class="st">"Cluster"</span>, <span class="va">MouseID</span>, <span class="va">Antibody</span>, <span class="va">Treatment</span>, <span class="va">Sex</span>, <span class="va">BrainRegion</span><span class="op">)</span></span>
<span><span class="va">cp</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cp</span><span class="op">$</span><span class="va">Treatment</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PBS"</span>,<span class="st">"2xLPS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update cluster labels</span></span>
<span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="va">cp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Cluster <span class="op">=</span> </span>
<span>                      <span class="fu">case_when</span><span class="op">(</span><span class="va">Cluster</span><span class="op">==</span><span class="st">"1"</span> <span class="op">~</span> <span class="st">"Rod-like"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"2"</span> <span class="op">~</span> <span class="st">"Ameboid"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"3"</span> <span class="op">~</span> <span class="st">"Ramified"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"4"</span> <span class="op">~</span> <span class="st">"Hypertrophic"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quick check of cluster proportions when considering experimental variables of interest</span></span>
<span><span class="va">cp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">BrainRegion</span><span class="op">==</span><span class="st">"STR"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># in this example, we filter for our brain region of interest</span></span>
<span>  <span class="fu"><a href="reference/clusterpercentage_boxplots.html">clusterpercentage_boxplots</a></span><span class="op">(</span><span class="va">Antibody</span>, <span class="va">Treatment</span><span class="op">)</span> <span class="co"># grouping variables</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-21-1.png"><!-- --></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example graph of data given variables of interest</span></span>
<span><span class="va">cp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Iba1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Cluster</span>, y<span class="op">=</span><span class="va">percentage</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">Treatment</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">BrainRegion</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">Treatment</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">Treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#fde725"</span>,<span class="st">"#482878"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.75</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>,<span class="va">Treatment</span><span class="op">)</span>, color<span class="op">=</span><span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"2xLPS mouse dataset: K-means clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, vjust<span class="op">=</span><span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-22-1.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-analysis">Statistical analysis<a class="anchor" aria-label="anchor" href="#statistical-analysis"></a>
</h2>
<p>MicrogliaMorphologyR includes a few functions to run stats on cluster percentages as well as on individual morphology measures.</p>
<div class="section level3">
<h3 id="cluster-percentage-changes-at-animal-level-in-response-to-experimental-variables">Cluster percentage changes at animal level, in response to experimental variables<a class="anchor" aria-label="anchor" href="#cluster-percentage-changes-at-animal-level-in-response-to-experimental-variables"></a>
</h3>
<div class="section level4">
<h4 id="eg-across-clusters---how-does-cluster-membership-change-with-lps">e.g., Across clusters - How does cluster membership change with LPS?<a class="anchor" aria-label="anchor" href="#eg-across-clusters---how-does-cluster-membership-change-with-lps"></a>
</h4>
<p>The stats_cluster.animal function fits a generalized linear mixed model on your dataset to a beta distribution, which is suitable for values like percentages or probabilities that are constrained to a range of 0-1, using the <code>glmmTMB</code> package. Part of the output includes a check of the model fit using the <code>DHARMa</code> package, which “uses a simulation-based approach to create readily interpretable scaled (quantile) residuals for fitted (generalized) linear mixed models.” The function creates two <code>DHARMa</code> plots, contained in output[[4]]. You can read more about how to interpret model fit using <code>DHARMa</code> by reading the package <a href="https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html" class="external-link">vignette</a>.</p>
<p>In this example, we are fitting the generalized linear mixed model to our Iba1-stained dataset to model the percentage of cluster membership as a factor of Cluster identity, Treatment, and BrainRegion interactions with MouseID as a repeated measure since the outcome variable (cluster percentages) is represented multiple times per animal. In the first posthoc correction, we are correcting for multiple tests between treatments (PBS vs. 2xLPS) across Clusters and BrainRegions using the Bonferroni method - since there are 4 clusters and 3 brain regions, we should be correcting across 12 tests. In the second posthoc correction, we are correcting for multiple tests between treatments (PBS vs. 2xLPS) across Clusters using the Bonferroni method - since there are 4 clusters, we should be correcting across 4 tests.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare percentages dataset for downstream analysis</span></span>
<span><span class="va">stats.input</span> <span class="op">&lt;-</span> <span class="va">cp</span></span>
<span><span class="va">stats.input</span><span class="op">$</span><span class="va">MouseID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stats.input</span><span class="op">$</span><span class="va">MouseID</span><span class="op">)</span></span>
<span><span class="va">stats.input</span><span class="op">$</span><span class="va">Cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stats.input</span><span class="op">$</span><span class="va">Cluster</span><span class="op">)</span></span>
<span><span class="va">stats.input</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stats.input</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run stats analysis for changes in cluster percentages, at the animal level</span></span>
<span><span class="co"># you can specify up to two posthoc comparisons (posthoc1 and posthoc2 arguments) - if you only have one set of posthocs to run, specify the same comparison twice for both arguments. you will just get the same results in output[[2]] and output[[3]].</span></span>
<span><span class="va">stats.testing</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stats_cluster.animal.html">stats_cluster.animal</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">stats.input</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Iba1"</span><span class="op">)</span>, </span>
<span>                                      model <span class="op">=</span> <span class="st">"percentage ~ Cluster*Treatment*BrainRegion + (1|MouseID)"</span>, </span>
<span>                                      posthoc1 <span class="op">=</span> <span class="st">"~Treatment|Cluster|BrainRegion"</span>, </span>
<span>                                      posthoc2 <span class="op">=</span> <span class="st">"~Treatment|Cluster"</span>, adjust <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-23-1.png"><!-- --></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## </span><span class="al">NOTE</span><span class="do">: Results may be misleading due to involvement in interactions</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Formula:          </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## percentage ~ Cluster * Treatment * BrainRegion + (1 | MouseID)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Data: data</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">##       AIC       BIC    logLik  df.resid </span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## -264.2217 -206.5145  158.1109        42 </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Random-effects (co)variances:</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Conditional model:</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  Groups  Name        Std.Dev. </span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  MouseID (Intercept) 2.874e-06</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of obs: 68 / Conditional model: MouseID, 6</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Dispersion parameter for beta family ():  296 </span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Fixed Effects:</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Conditional model:</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="do">##                      (Intercept)                          Cluster1  </span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -1.190535                         -0.280517  </span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="do">##                         Cluster2                          Cluster3  </span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.530336                          0.729137  </span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="do">##                       Treatment1                      BrainRegion1  </span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.034300                         -0.001085  </span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="do">##                     BrainRegion2               Cluster1:Treatment1  </span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.032280                          0.258393  </span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="do">##              Cluster2:Treatment1               Cluster3:Treatment1  </span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.571028                          0.123271  </span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster1:BrainRegion1             Cluster2:BrainRegion1  </span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.038133                         -0.026514  </span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster3:BrainRegion1             Cluster1:BrainRegion2  </span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.093337                         -0.070106  </span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster2:BrainRegion2             Cluster3:BrainRegion2  </span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.327990                         -0.213648  </span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="do">##          Treatment1:BrainRegion1           Treatment1:BrainRegion2  </span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.026359                          0.016676  </span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster1:Treatment1:BrainRegion1  Cluster2:Treatment1:BrainRegion1  </span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.040356                         -0.105077  </span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster3:Treatment1:BrainRegion1  Cluster1:Treatment1:BrainRegion2  </span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.146770                         -0.041974  </span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster2:Treatment1:BrainRegion2  Cluster3:Treatment1:BrainRegion2  </span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.074843                          0.057942</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># anova</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Analysis of Deviance Table (Type II Wald chisquare tests)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Response: percentage</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="do">##                                  Chisq Df Pr(&gt;Chisq)    </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster                       632.4489  3  &lt; 2.2e-16 ***</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment                       1.2604  1     0.2616    </span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion                     0.2084  2     0.9010    </span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster:Treatment             271.0010  3  &lt; 2.2e-16 ***</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster:BrainRegion           120.9206  6  &lt; 2.2e-16 ***</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion           2.0685  2     0.3555    </span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster:Treatment:BrainRegion  38.4144  6  9.321e-07 ***</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># posthoc 1</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast    Cluster      BrainRegion   estimate         SE  df z.ratio p.value</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ameboid      FC           0.4761810 0.12097423 Inf   3.936  0.0010</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Hypertrophic FC          -1.4735270 0.14575418 Inf -10.110  &lt;.0001</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ramified     FC           0.4187652 0.09890623 Inf   4.234  0.0003</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Rod-like     FC           0.0933096 0.10739883 Inf   0.869  1.0000</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ameboid      HC           0.3975890 0.13631864 Inf   2.917  0.0425</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Hypertrophic HC          -1.3269896 0.14559103 Inf  -9.115  &lt;.0001</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ramified     HC           0.3271790 0.11116900 Inf   2.943  0.0390</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Rod-like     HC           0.4612288 0.12234620 Inf   3.770  0.0020</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ameboid      STR          0.4707876 0.12231266 Inf   3.849  0.0014</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Hypertrophic STR         -0.8314491 0.15327901 Inf  -5.424  &lt;.0001</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ramified     STR         -0.2121170 0.09521815 Inf  -2.228  0.3108</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Rod-like     STR          0.3758423 0.11203993 Inf   3.355  0.0095</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  Significant</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Results are given on the log odds ratio (not the response) scale. </span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 12 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="co"># posthoc 2</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast    Cluster        estimate         SE  df z.ratio p.value Significant</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ameboid       0.4481859 0.07316652 Inf   6.126  &lt;.0001 significant</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Hypertrophic -1.2106552 0.08561031 Inf -14.141  &lt;.0001 significant</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Ramified      0.1779424 0.05888547 Inf   3.022  0.0100 significant</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS - 2xLPS Rod-like      0.3101269 0.06587576 Inf   4.708  &lt;.0001 significant</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Results are averaged over the levels of: BrainRegion </span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Results are given on the log odds ratio (not the response) scale. </span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 4 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="co"># DHARMa model check</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-23-2.png"><!-- --></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="co"># summary of model</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Formula:          </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="do">## percentage ~ Cluster * Treatment * BrainRegion + (1 | MouseID)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Data: data</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       AIC       BIC    logLik  df.resid </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="do">## -264.2217 -206.5145  158.1109        42 </span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Random-effects (co)variances:</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Conditional model:</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Groups  Name        Std.Dev. </span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  MouseID (Intercept) 2.874e-06</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of obs: 68 / Conditional model: MouseID, 6</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Dispersion parameter for beta family ():  296 </span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Fixed Effects:</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Conditional model:</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="do">##                      (Intercept)                          Cluster1  </span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -1.190535                         -0.280517  </span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="do">##                         Cluster2                          Cluster3  </span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.530336                          0.729137  </span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="do">##                       Treatment1                      BrainRegion1  </span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.034300                         -0.001085  </span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="do">##                     BrainRegion2               Cluster1:Treatment1  </span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.032280                          0.258393  </span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="do">##              Cluster2:Treatment1               Cluster3:Treatment1  </span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.571028                          0.123271  </span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster1:BrainRegion1             Cluster2:BrainRegion1  </span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.038133                         -0.026514  </span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster3:BrainRegion1             Cluster1:BrainRegion2  </span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.093337                         -0.070106  </span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="do">##            Cluster2:BrainRegion2             Cluster3:BrainRegion2  </span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.327990                         -0.213648  </span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="do">##          Treatment1:BrainRegion1           Treatment1:BrainRegion2  </span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.026359                          0.016676  </span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster1:Treatment1:BrainRegion1  Cluster2:Treatment1:BrainRegion1  </span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.040356                         -0.105077  </span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster3:Treatment1:BrainRegion1  Cluster1:Treatment1:BrainRegion2  </span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="do">##                         0.146770                         -0.041974  </span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster2:Treatment1:BrainRegion2  Cluster3:Treatment1:BrainRegion2  </span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="do">##                        -0.074843                          0.057942</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="individual-morphology-measures-at-the-animal-level-averaged-across-cells-for-each-animal">Individual morphology measures, at the animal level (averaged across cells for each animal)<a class="anchor" aria-label="anchor" href="#individual-morphology-measures-at-the-animal-level-averaged-across-cells-for-each-animal"></a>
</h3>
<div class="section level4">
<h4 id="eg-how-does-each-individual-morphology-measure-change-with-lps-treatment">e.g., How does each individual morphology measure change with LPS treatment?<a class="anchor" aria-label="anchor" href="#eg-how-does-each-individual-morphology-measure-change-with-lps-treatment"></a>
</h4>
<p>The stats_morphologymeasures.animal function fits a linear model using the <code>lm</code> function for each morphology measure individually within your dataset.</p>
<p>In this example, we are fitting the linear model to our Iba1-stained dataset to model the values of each morphology measure as a factor of Treatment and BrainRegion interactions. In the first posthoc correction, we are correcting for multiple comparisons between treatments (PBS vs. 2xLPS) across BrainRegions using the Bonferroni method - since there are 3 brain regions, we should be correcting across 3 tests for each morphology measure. In the second posthoc correction, we are correcting for multiple comparisons between every individual interaction of treatment (PBS or 2xLPS) and brain region (FC, HC, STR) against the others (e.g., 2xLPS FC vs. PBS STR) and should be correcting across 15 tests for each morphology measure. In the second example, we are testing all possible comparisons given the experimental variables in our model, and are thus considering many tests that aren’t biologically relevant or useful in our experiment.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare data for downstream analysis</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_2xLPS</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">MouseID</span>, <span class="va">Sex</span>, <span class="va">Treatment</span>, <span class="va">BrainRegion</span>, <span class="va">Antibody</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="st">"Foreground pixels"</span><span class="op">:</span><span class="st">"Maximum branch length"</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">Measure</span>, <span class="va">Value</span>, <span class="st">"Foreground pixels"</span><span class="op">:</span><span class="st">"Maximum branch length"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by 'MouseID', 'Sex', 'Treatment',</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 'BrainRegion'. You can override using the `.groups` argument.</span></span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter out data you want to run stats on and make sure to make any variables included in model into factors</span></span>
<span><span class="va">stats.input</span> <span class="op">&lt;-</span> <span class="va">data</span> </span>
<span><span class="va">stats.input</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stats.input</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run stats analysis for changes in individual morphology measures</span></span>
<span><span class="co"># you can specify up to two posthoc comparisons (posthoc1 and posthoc2 arguments) - if you only have one set of posthocs to run, specify the same comparison twice for both arguments. you will just get the same results in output[[2]] and output[[3]].</span></span>
<span><span class="va">stats.testing</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stats_morphologymeasures.animal.html">stats_morphologymeasures.animal</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">stats.input</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Iba1"</span><span class="op">)</span>, </span>
<span>                                                 model <span class="op">=</span> <span class="st">"Value ~ Treatment*BrainRegion"</span>, type<span class="op">=</span><span class="st">"lm"</span>,</span>
<span>                                                 posthoc1 <span class="op">=</span> <span class="st">"~Treatment|BrainRegion"</span>, </span>
<span>                                                 posthoc2 <span class="op">=</span> <span class="st">"~Treatment*BrainRegion"</span>, adjust <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Foreground pixels"</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Density of foreground pixels in hull area"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Span ratio of hull (major/minor axis)"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum span across hull"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Area"</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Perimeter"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Circularity"</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Width of bounding rectangle"</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Height of bounding rectangle"</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum radius from hull's center of mass"</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Max/min radii from hull's center of mass"</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Relative variation (CV) in radii from hull's center of mass"</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Mean radius"</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Diameter of bounding circle"</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum radius from circle's center of mass"</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Max/min radii from circle's center of mass"</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Relative variation (CV) in radii from circle's center of mass"</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Mean radius from circle's center of mass"</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of branches"</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of junctions"</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of end point voxels"</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of junction voxels"</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of slab voxels"</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Average branch length"</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of triple points"</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of quadruple points"</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum branch length"</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># anova</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                              Sum Sq Df   F value       Pr(&gt;F)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment              6.875349e+05  1 65.060279 6.040851e-06</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion            6.273589e+04  2  2.968296 9.313579e-02</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion  6.182606e+04  2  2.925248 9.578334e-02</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals              1.162443e+05 11        NA           NA</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment1             2.318244e-02  1 61.707786 7.765694e-06</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion1           5.230256e-03  2  6.961034 1.112878e-02</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion1 1.396941e-03  2  1.859211 2.015685e-01</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals1             4.132491e-03 11        NA           NA</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                                                          measure Significant</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment                                      Foreground pixels significant</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion                                    Foreground pixels          ns</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion                          Foreground pixels          ns</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals                                      Foreground pixels        &lt;NA&gt;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment1             Density of foreground pixels in hull area significant</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion1           Density of foreground pixels in hull area significant</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion1 Density of foreground pixels in hull area          ns</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals1             Density of foreground pixels in hull area        &lt;NA&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posthoc 1</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast    BrainRegion estimate       SE df t.ratio p.value</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS FC          244.1962 83.93513 11   2.909  0.0426</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS HC          464.8970 93.84233 11   4.954  0.0013</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS STR         516.7580 83.93513 11   6.157  0.0002</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS FC            0.0730  0.01583 11   4.613  0.0022</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS HC            0.1004  0.01769 11   5.675  0.0004</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS STR           0.0547  0.01583 11   3.456  0.0161</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  measure                                   Significant</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Foreground pixels                         significant</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  Foreground pixels                         significant</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  Foreground pixels                         significant</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 3 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posthoc 2</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast              estimate       SE df t.ratio p.value measure          </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS FC     244.1962 83.93513 11   2.909  0.2131 Foreground pixels</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - 2xLPS HC    37.2602 83.93513 11   0.444  1.0000 Foreground pixels</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS HC     502.1572 93.84233 11   5.351  0.0035 Foreground pixels</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - 2xLPS STR  -25.7262 83.93513 11  -0.307  1.0000 Foreground pixels</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS STR    491.0318 83.93513 11   5.850  0.0017 Foreground pixels</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS FC - 2xLPS HC    -206.9360 83.93513 11  -2.465  0.4706 Foreground pixels</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  Significant</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  significant</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  ns         </span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 15 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># qqplots to check normality assumptions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"grid.arrange"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-24-1.png"><!-- --></p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># shapiro test</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           variable statistic   p.value pass</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 residuals(model) 0.9541450 0.5252634 pass</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 residuals(model) 0.9874225 0.9958905 pass</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 residuals(model) 0.9518543 0.4865020 pass</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 residuals(model) 0.9481459 0.4278652 pass</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 residuals(model) 0.9832680 0.9809502 pass</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 residuals(model) 0.9770036 0.9250129 pass</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                                     measure</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                         Foreground pixels</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Density of foreground pixels in hull area</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3     Span ratio of hull (major/minor axis)</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4                  Maximum span across hull</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5                                      Area</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 6                                 Perimeter</span></span></code></pre></div>
<p>If you are not interested in running stats for all 27 morphology measures, you can also filter for those that you are interested in (or filter out those that you’re not interested in) prior to running the <code>stats_morphologymeasures.animal</code> function. In this example, we filter out 4 morphology measures so that we only run this function on the other 23 measures.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run stats analysis for changes in individual morphology measures</span></span>
<span><span class="co"># you can specify up to two posthoc comparisons (posthoc1 and posthoc2 arguments) - if you only have one set of posthocs to run, specify the same comparison twice for both arguments. you will just get the same results in output[[2]] and output[[3]].</span></span>
<span><span class="va">stats.testing</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stats_morphologymeasures.animal.html">stats_morphologymeasures.animal</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">stats.input</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Iba1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Measure</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Foreground pixels"</span>,</span>
<span>                                                                          <span class="st">"Average branch length"</span>,</span>
<span>                                                                          <span class="st">"# of quadruple points"</span>,</span>
<span>                                                                          <span class="st">"Height of bounding rectangle"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                                 model <span class="op">=</span> <span class="st">"Value ~ Treatment*BrainRegion"</span>, type <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>                                                 posthoc1 <span class="op">=</span> <span class="st">"~Treatment|BrainRegion"</span>, </span>
<span>                                                 posthoc2 <span class="op">=</span> <span class="st">"~Treatment*BrainRegion"</span>, adjust <span class="op">=</span><span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Density of foreground pixels in hull area"</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Span ratio of hull (major/minor axis)"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum span across hull"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Area"</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Perimeter"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Circularity"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Width of bounding rectangle"</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum radius from hull's center of mass"</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Max/min radii from hull's center of mass"</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Relative variation (CV) in radii from hull's center of mass"</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Mean radius"</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Diameter of bounding circle"</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum radius from circle's center of mass"</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Max/min radii from circle's center of mass"</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Relative variation (CV) in radii from circle's center of mass"</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Mean radius from circle's center of mass"</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of branches"</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of junctions"</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of end point voxels"</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of junction voxels"</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of slab voxels"</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "# of triple points"</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "Maximum branch length"</span></span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># anova</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                              Sum Sq Df    F value       Pr(&gt;F)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment              0.0231824401  1 61.7077864 7.765694e-06</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion            0.0052302556  2  6.9610338 1.112878e-02</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion  0.0013969407  2  1.8592115 2.015685e-01</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals              0.0041324905 11         NA           NA</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment1             0.0008300607  1  0.2688058 6.144032e-01</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion1           0.0437404668  2  7.0824290 1.055091e-02</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion1 0.0223637009  2  3.6211164 6.190572e-02</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals1             0.0339675228 11         NA           NA</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                                                          measure Significant</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment              Density of foreground pixels in hull area significant</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion            Density of foreground pixels in hull area significant</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion  Density of foreground pixels in hull area          ns</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals              Density of foreground pixels in hull area        &lt;NA&gt;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment1                 Span ratio of hull (major/minor axis)          ns</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="do">## BrainRegion1               Span ratio of hull (major/minor axis) significant</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Treatment:BrainRegion1     Span ratio of hull (major/minor axis)          ns</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals1                 Span ratio of hull (major/minor axis)        &lt;NA&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posthoc 1</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast    BrainRegion    estimate         SE df t.ratio p.value</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS FC           0.07300851 0.01582574 11   4.613  0.0022</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS HC           0.10040427 0.01769371 11   5.675  0.0004</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS STR          0.05469185 0.01582574 11   3.456  0.0161</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS FC           0.09192749 0.04537221 11   2.026  0.2031</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS HC           0.03246885 0.05072768 11   0.640  1.0000</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS - PBS STR         -0.07853956 0.04537221 11  -1.731  0.3341</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  measure                                   Significant</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  Span ratio of hull (major/minor axis)     ns         </span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Span ratio of hull (major/minor axis)     ns         </span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  Span ratio of hull (major/minor axis)     ns         </span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 3 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posthoc 2</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  contrast                estimate         SE df t.ratio p.value</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS FC     0.07300851 0.01582574 11   4.613  0.0112</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - 2xLPS HC  -0.00476249 0.01582574 11  -0.301  1.0000</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS HC     0.09564178 0.01769371 11   5.405  0.0032</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - 2xLPS STR  0.04837071 0.01582574 11   3.056  0.1638</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2xLPS FC - PBS STR    0.10306256 0.01582574 11   6.512  0.0007</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  PBS FC - 2xLPS HC    -0.07777099 0.01582574 11  -4.914  0.0069</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  measure                                   Significant</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area ns         </span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area ns         </span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  Density of foreground pixels in hull area significant</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="do">## P value adjustment: bonferroni method for 15 tests</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># qqplots to check normality assumptions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"grid.arrange"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-25-1.png"><!-- --></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># shapiro test</span></span>
<span><span class="va">stats.testing</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           variable statistic    p.value pass</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 residuals(model) 0.9874225 0.99589048 pass</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 residuals(model) 0.9518543 0.48650203 pass</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 residuals(model) 0.9481459 0.42786519 pass</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 residuals(model) 0.9832680 0.98095021 pass</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 residuals(model) 0.9770036 0.92501287 pass</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 residuals(model) 0.9079043 0.09221502 pass</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                                     measure</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Density of foreground pixels in hull area</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2     Span ratio of hull (major/minor axis)</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                  Maximum span across hull</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4                                      Area</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5                                 Perimeter</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 6                               Circularity</span></span></code></pre></div>
<p>If you find that any individual morphology measures violate assumptions of normality after checking the qqplots contained in stats.input[[4]], you can filter your data for those measures, transform your data in the suitable manner (i.e., using MicrogliaMorphologyR functions like <code>transform_minmax</code> or <code>transform_scale</code> or other data transformations), and rerun the stats for those morphology features using the code above.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fuzzy-k-means-clustering">Fuzzy K-means Clustering<a class="anchor" aria-label="anchor" href="#fuzzy-k-means-clustering"></a>
</h2>
<p>To cluster your cells into morphological classes, you can use regular k-means or fuzzy k-means clustering. We provide an example of using fuzzy k-means, a ‘soft’ clustering method that is similar in concept and algorithm to k-means clustering, which partitions data points within a given dataset into defined numbers of clusters based on their proximity to the nearest cluster’s centroid. In fuzzy k-means, data points are not exclusively assigned to just one cluster, but rather given membership scores to all clusters. This allows for additional characterization of high-scoring cells within each cluster (i.e., quintessential ‘rod-like’, ‘ameboid’, ‘hypertrophic’, or ‘ramified’ cells), cells with more ambiguous identities (e.g., a cell that is 5% rod-like, 5% ameboid, 45% hypertrophic, and 45% ramified), and other cases that the user might be interested in which might be informative for their specific dataset. Fuzzy k-means also assigns a final hard cluster assignment based on the class with the highest membership score, which can be used as input for analysis as well. Here, we include an example of one use case of the membership scores provided by fuzzy k-means.</p>
<div class="section level3">
<h3 id="example-of-additional-analyses-possible-with-fuzzy-k-means-soft-clustering-membership-scores">Example of additional analyses possible with fuzzy k-means (soft clustering) membership scores<a class="anchor" aria-label="anchor" href="#example-of-additional-analyses-possible-with-fuzzy-k-means-soft-clustering-membership-scores"></a>
</h3>
<p>Here, we will use a fuzzy k-means dataset that comes pre-loaded with the package for demonstration purposes, as running the actual fuzzy clustering step using the <code>fcm</code> function in the <code>ppclust</code> <a href="https://cran.r-project.org/web/packages/ppclust/vignettes/fcm.html" class="external-link">package</a> is time-intensive and computationally-expensive.</p>
<p>Load in example dataset:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_fuzzykmeans</span> <span class="op">&lt;-</span> <span class="fu">MicrogliaMorphologyR</span><span class="fu">::</span><span class="va"><a href="reference/data_2xLPS_mouse_fuzzykmeans.html">data_2xLPS_mouse_fuzzykmeans</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_fuzzykmeans</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "Antibody"                                                     </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2] "MouseID"                                                      </span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3] "Sex"                                                          </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4] "Treatment"                                                    </span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5] "BrainRegion"                                                  </span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6] "Subregion"                                                    </span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] "ID"                                                           </span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] "UniqueID"                                                     </span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9] "Foreground pixels"                                            </span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [10] "Density of foreground pixels in hull area"                    </span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [11] "Span ratio of hull (major/minor axis)"                        </span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [12] "Maximum span across hull"                                     </span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] "Area"                                                         </span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [14] "Perimeter"                                                    </span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [15] "Circularity"                                                  </span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [16] "Width of bounding rectangle"                                  </span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [17] "Height of bounding rectangle"                                 </span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [18] "Maximum radius from hull's center of mass"                    </span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [19] "Max/min radii from hull's center of mass"                     </span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [20] "Relative variation (CV) in radii from hull's center of mass"  </span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [21] "Mean radius"                                                  </span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [22] "Diameter of bounding circle"                                  </span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [23] "Maximum radius from circle's center of mass"                  </span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [24] "Max/min radii from circle's center of mass"                   </span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [25] "Relative variation (CV) in radii from circle's center of mass"</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [26] "Mean radius from circle's center of mass"                     </span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [27] "# of branches"                                                </span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [28] "# of junctions"                                               </span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [29] "# of end point voxels"                                        </span></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [30] "# of junction voxels"                                         </span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [31] "# of slab voxels"                                             </span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [32] "Average branch length"                                        </span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [33] "# of triple points"                                           </span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a><span class="do">## [34] "# of quadruple points"                                        </span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [35] "Maximum branch length"                                        </span></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [36] "PC1"                                                          </span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a><span class="do">## [37] "PC2"                                                          </span></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [38] "PC3"                                                          </span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a><span class="do">## [39] "Cluster 1"                                                    </span></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a><span class="do">## [40] "Cluster 2"                                                    </span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a><span class="do">## [41] "Cluster 3"                                                    </span></span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a><span class="do">## [42] "Cluster 4"                                                    </span></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a><span class="do">## [43] "Cluster"</span></span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check cluster features to determine cluster labels</span></span>
<span><span class="fu"><a href="reference/clusterfeatures.html">clusterfeatures</a></span><span class="op">(</span><span class="va">data_fuzzykmeans</span>, featurestart<span class="op">=</span><span class="fl">9</span>, featureend<span class="op">=</span><span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-26-1.png"><!-- --></p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># update cluster labels</span></span>
<span><span class="va">data_fuzzykmeans</span> <span class="op">&lt;-</span> <span class="va">data_fuzzykmeans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Cluster <span class="op">=</span> </span>
<span>                      <span class="fu">case_when</span><span class="op">(</span><span class="va">Cluster</span><span class="op">==</span><span class="st">"1"</span> <span class="op">~</span> <span class="st">"Ameboid"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"2"</span> <span class="op">~</span> <span class="st">"Rod-like"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"3"</span> <span class="op">~</span> <span class="st">"Hypertrophic"</span>,</span>
<span>                                <span class="va">Cluster</span><span class="op">==</span><span class="st">"4"</span> <span class="op">~</span> <span class="st">"Ramified"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Example: Characterization of just the high-scoring cells within each cluster (i.e., quintessential ‘rod-like’, ‘ameboid’, ‘hypertrophic’, or ‘ramified’ cells)</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_fuzzykmeans</span><span class="op">)</span> <span class="co"># number of cells prior to filtering</span></span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 43332</span></span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter for high-scoring cells, defined as &gt;70% membership score in one of the clusters</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_fuzzykmeans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Cluster 1`</span> <span class="op">&gt;</span> <span class="fl">0.70</span><span class="op">|</span></span>
<span>         <span class="va">`Cluster 2`</span> <span class="op">&gt;</span> <span class="fl">0.70</span><span class="op">|</span></span>
<span>         <span class="va">`Cluster 3`</span> <span class="op">&gt;</span> <span class="fl">0.70</span><span class="op">|</span></span>
<span>         <span class="va">`Cluster 4`</span> <span class="op">&gt;</span> <span class="fl">0.70</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># number of cells after filtering for just the high-scoring cells</span></span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7525</span></span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate cluster percentages across variables of interest</span></span>
<span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clusterpercentage.html">clusterpercentage</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"Cluster"</span>, <span class="va">MouseID</span>, <span class="va">Antibody</span>, <span class="va">Treatment</span>, <span class="va">Sex</span>, <span class="va">BrainRegion</span><span class="op">)</span></span>
<span><span class="va">cp</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cp</span><span class="op">$</span><span class="va">Treatment</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PBS"</span>,<span class="st">"2xLPS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># example graph of data given variables of interest</span></span>
<span><span class="va">cp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Antibody</span><span class="op">==</span><span class="st">"Iba1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Cluster</span>, y<span class="op">=</span><span class="va">percentage</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">Treatment</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">BrainRegion</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">Treatment</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">Treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#fde725"</span>,<span class="st">"#482878"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.75</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Cluster</span>,<span class="va">Treatment</span><span class="op">)</span>, color<span class="op">=</span><span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"2xLPS mouse dataset: K-means clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, vjust<span class="op">=</span><span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-27-1.png"><!-- --></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MicrogliaMorphologyR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jennifer Kim <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2922-1010" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jennifer Kim.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
